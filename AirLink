#include <Wire.h> // Librería para comunicación I2C
#include <Adafruit_MPU6050.h> // Librería del sensor MPU-6050
#include <Adafruit_Sensor.h> // Librería base de Adafruit para sensores
#include <BleMouse.h>

BleMouse bleMouse("ESP32 Mouse", "ESP32", 100);
Adafruit_MPU6050 mpu;
const int VRX_PIN = 34;
const int VRY_PIN = 35;

void setup() {
  Serial.begin(115200); 
  bleMouse.begin();
  pinMode(15  , INPUT_PULLUP);
  pinMode(10, INPUT_PULLUP);
  pinMode(9, INPUT_PULLUP);

  Serial.println("Inicializando MPU-6050...");

  if (!mpu.begin()) {
    while (1) {
      delay(100); 
    }
  }

  mpu.setAccelerometerRange(MPU6050_RANGE_8_G); 
  mpu.setGyroRange(MPU6050_RANGE_500_DEG);     
  mpu.setFilterBandwidth(MPU6050_BAND_21_HZ);  
}

void loop() {
  int x = digitalRead(10);
  int y = digitalRead(9);
  int z  = digitalRead( 15);
  static int l = 0; //cambia de girosc a joystick
  static int m = 0; //contador click
  static int k = 0; //solo clickear 1 ves
  int xValue = analogRead(VRX_PIN);
  int yValue = analogRead(VRY_PIN);
  sensors_event_t a, g, temp;
  mpu.getEvent(&a, &g, &temp);

xValue = xValue-2850;
yValue = yValue-2850;
if(xValue < 0){
  xValue = xValue/2.289;}
if(yValue < 0){
  yValue = yValue/2.289;}
  
 if(xValue == 1245 && yValue == 1245){
  xValue = 0;
  yValue = 0;}

if(g.gyro.x < 0){
    if(g.gyro.x >= -0.15){
     g.gyro.x = 0;}}
if(xValue/20.73 < 0){
    if(xValue/20.73 >= -5){
     xValue = 0;}}
if(yValue/20.73 < 0){
    if(yValue/20.73 >= -5){
     yValue = 0;}}


if (y == 0) { 
  l = (l-1);
  l = l*l;
  delay(600);}
if (l == 0) {
bleMouse.move(-g.gyro.z*60,-g.gyro.x*40,-yValue/1000,xValue/1000);}
if (l == 1) {
bleMouse.move(-g.gyro.z*20+xValue/207.3,-g.gyro.x*15+yValue/207.3);}


//BOTONES
if (x == 0) {
m = m+1;
if(m > 7){
bleMouse.press();
}}
if (x != 0) {
if(m < 7){
if(m !=0){
if(k == 0){
bleMouse.click();
k = 1;}}}
m = 0;
k = 0;
bleMouse.release();}
if (z == 0) {bleMouse.click(MOUSE_RIGHT);
delay(600);}
delay(30); // Pausa para no saturar el puerto serial
}
